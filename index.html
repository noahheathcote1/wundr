<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>wundr</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f8f9fa;
            color: #2c3e50;
            line-height: 1.6;
        }
        
        .container {
            max-width: 400px;
            margin: 0 auto;
            background: #ffffff;
            min-height: 100vh;
            position: relative;
        }
        
        .screen {
            display: none;
            padding: 40px 30px;
            min-height: 100vh;
        }
        
        .screen.active {
            display: block;
        }
        
        .logo {
            text-align: center;
            margin: 80px 0 60px 0;
        }
        
        .logo h1 {
            font-size: 48px;
            font-weight: 300;
            color: #2c3e50;
            letter-spacing: -1px;
        }
        
        .subtitle {
            text-align: center;
            color: #7f8c8d;
            font-size: 16px;
            margin-bottom: 60px;
            font-weight: 300;
        }
        
        .btn {
            width: 100%;
            padding: 16px 20px;
            border: none;
            border-radius: 50px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }
        
        .btn-primary {
            background: #2c3e50;
            color: white;
        }
        
        .btn-primary:hover {
            background: #34495e;
            transform: translateY(-1px);
        }
        
        .status-card {
            background: #f8f9fa;
            border-radius: 20px;
            padding: 25px;
            margin: 30px 0;
            text-align: center;
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 10px;
        }
        
        .status-indicator.active {
            background: #27ae60;
            box-shadow: 0 0 10px rgba(39, 174, 96, 0.3);
        }
        
        .status-indicator.inactive {
            background: #e74c3c;
        }
        
        .location-card {
            background: white;
            border-radius: 20px;
            padding: 20px;
            margin: 15px 0;
            border-left: 4px solid #3498db;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            animation: slideIn 0.3s ease;
        }
        
        .location-card.street { border-left-color: #95a5a6; }
        .location-card.business { border-left-color: #e74c3c; }
        .location-card.landmark { border-left-color: #9b59b6; }
        .location-card.area { border-left-color: #f39c12; }
        .location-card.postal { border-left-color: #3498db; }
        
        .location-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }
        
        .location-title {
            font-size: 18px;
            font-weight: 600;
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .location-tag {
            background: #ecf0f1;
            color: #7f8c8d;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 10px;
            font-weight: 500;
            text-transform: uppercase;
        }
        
        .location-content {
            color: #7f8c8d;
            font-size: 14px;
            line-height: 1.4;
            margin-bottom: 8px;
        }
        
        .location-meta {
            font-size: 11px;
            color: #bdc3c7;
        }
        
        .current-location {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 20px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }
        
        .current-location h3 {
            font-size: 20px;
            margin-bottom: 10px;
        }
        
        .address-line {
            font-size: 14px;
            margin-bottom: 5px;
            opacity: 0.9;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
            margin: 20px 0;
        }
        
        .stat-item {
            text-align: center;
            background: white;
            padding: 15px 10px;
            border-radius: 15px;
            border: 1px solid #f1f2f6;
        }
        
        .stat-number {
            font-size: 18px;
            font-weight: 600;
            color: #2c3e50;
            display: block;
        }
        
        .stat-label {
            font-size: 9px;
            color: #7f8c8d;
            margin-top: 3px;
            text-transform: uppercase;
        }
        
        .floating-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #3498db, #2980b9);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 20px;
            cursor: pointer;
            box-shadow: 0 10px 30px rgba(52, 152, 219, 0.3);
            transition: transform 0.3s ease;
            z-index: 100;
        }
        
        .floating-btn:hover {
            transform: scale(1.1);
        }
        
        .floating-btn.scanning {
            animation: pulse 2s infinite;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            backdrop-filter: blur(10px);
        }
        
        .modal-content {
            background: white;
            margin: 10% auto;
            padding: 30px;
            width: 90%;
            max-width: 350px;
            border-radius: 25px;
            position: relative;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            animation: modalSlideIn 0.4s ease;
        }
        
        .modal-close {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 24px;
            cursor: pointer;
            color: #bdc3c7;
        }
        
        .section-title {
            font-size: 18px;
            font-weight: 600;
            color: #2c3e50;
            margin: 25px 0 15px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #bdc3c7;
        }
        
        .loading-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
            margin-right: 10px;
        }
        
        .notification-banner {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 20px;
            text-align: center;
            font-size: 13px;
            position: fixed;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 400px;
            z-index: 999;
            animation: slideDown 0.3s ease;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(52, 152, 219, 0.7);
            }
            70% {
                box-shadow: 0 0 0 20px rgba(52, 152, 219, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(52, 152, 219, 0);
            }
        }
        
        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: scale(0.8) translateY(50px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }
        
        @keyframes slideDown {
            from {
                transform: translateX(-50%) translateY(-100%);
            }
            to {
                transform: translateX(-50%) translateY(0);
            }
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Login Screen -->
        <div id="login-screen" class="screen active">
            <div class="logo">
                <h1>wundr.</h1>
            </div>
            
            <div class="subtitle">discover real places around you</div>
            
            <button class="btn btn-primary" onclick="startApp()">Start Exploring</button>
            
            <div style="text-align: center; margin-top: 40px; color: #bdc3c7; font-size: 14px;">
                Uses real location data and reverse geocoding
            </div>
        </div>
        
        <!-- Main App Screen -->
        <div id="main-screen" class="screen">
            <div style="margin-bottom: 100px; padding-top: 20px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2 style="font-size: 24px; font-weight: 600;">wundr</h2>
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <button onclick="toggleAudio()" style="background: none; border: none; font-size: 20px; cursor: pointer;" title="Toggle Audio">
                            🔊
                        </button>
                        <div style="display: flex; align-items: center; font-size: 12px; color: #7f8c8d;">
                            <span class="status-indicator" id="location-status"></span>
                            <span id="location-text">Location</span>
                        </div>
                    </div>
                </div>
                
                <div class="status-card">
                    <div style="font-size: 24px; margin-bottom: 15px;">📍</div>
                    <div id="location-display">Detecting location...</div>
                    <div style="font-size: 12px; color: #7f8c8d; margin-top: 8px;" id="location-coords"></div>
                    <button class="btn btn-primary" onclick="enableLocation()" id="location-btn">Enable Location & Start Discovering</button>
                </div>
                
                <div id="current-location-info" style="display: none;">
                    <div class="current-location">
                        <h3 id="current-address">📍 Current Location</h3>
                        <div class="address-line" id="street-name"></div>
                        <div class="address-line" id="area-name"></div>
                        <div class="address-line" id="postal-code"></div>
                    </div>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-item">
                        <span class="stat-number" id="discoveries-count">0</span>
                        <div class="stat-label">FOUND</div>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number" id="locations-scanned">0</span>
                        <div class="stat-label">SCANNED</div>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number" id="last-discovery">--</span>
                        <div class="stat-label">LAST</div>
                    </div>
                </div>
                
                <div class="section-title">
                    🗺️ Location Details
                </div>
                <div id="location-details">
                    <div class="empty-state">
                        <div style="font-size: 32px; margin-bottom: 15px;">🔍</div>
                        <div>Enable location to see real place information</div>
                    </div>
                </div>
                
                <div class="section-title">
                    🏪 Nearby Places
                </div>
                <div id="nearby-places">
                    <div class="empty-state">
                        <div style="font-size: 32px; margin-bottom: 15px;">🏢</div>
                        <div>Searching for nearby businesses...</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Floating Scan Button -->
        <button class="floating-btn" onclick="scanCurrentArea()" id="scan-btn">📡</button>
    </div>
    
    <!-- Discovery Modal -->
    <div id="discovery-modal" class="modal">
        <div class="modal-content">
            <div class="modal-close" onclick="closeModal()">&times;</div>
            <div style="font-size: 40px; margin-bottom: 15px;" id="modal-icon">📍</div>
            <h3 id="modal-title" style="margin-bottom: 10px;">Location Discovery</h3>
            <div id="modal-tag" class="location-tag" style="margin-bottom: 15px;">place</div>
            <p id="modal-content" style="color: #7f8c8d; line-height: 1.5; margin-bottom: 15px;"></p>
            <div id="modal-meta" style="font-size: 12px; color: #bdc3c7; margin-bottom: 25px;"></div>
            <button class="btn btn-primary" onclick="closeModal()">Continue Exploring</button>
        </div>
    </div>

    <script>
        // App State
        let currentLocation = null;
        let isLocationEnabled = false;
        let discoveries = [];
        let scanCount = 0;
        let audioEnabled = true;
        let currentAudio = null;
        let currentAddress = null;

        // Speech synthesis
        function initializeSpeech() {
            if ('speechSynthesis' in window) {
                speechSynthesis.getVoices();
                speechSynthesis.onvoiceschanged = () => {
                    console.log('Speech voices loaded');
                };
            }
        }

        function playAudioDescription(text) {
            if (!audioEnabled || !('speechSynthesis' in window)) return;

            if (currentAudio) {
                speechSynthesis.cancel();
            }

            const utterance = new SpeechSynthesisUtterance(text);
            utterance.rate = 0.9;
            utterance.pitch = 1.0;
            utterance.volume = 0.8;
            
            const voices = speechSynthesis.getVoices();
            const preferredVoice = voices.find(voice => 
                voice.lang.startsWith('en-GB') || voice.lang.startsWith('en')
            );
            
            if (preferredVoice) {
                utterance.voice = preferredVoice;
            }

            speechSynthesis.speak(utterance);
            currentAudio = utterance;
            showAudioIndicator();
        }

        function showAudioIndicator() {
            const indicator = document.createElement('div');
            indicator.style.cssText = `
                position: fixed;
                top: 60px;
                left: 50%;
                transform: translateX(-50%);
                background: linear-gradient(135deg, #3498db, #2980b9);
                color: white;
                padding: 8px 15px;
                border-radius: 20px;
                font-size: 12px;
                z-index: 999;
            `;
            indicator.innerHTML = '🔊 Playing location info';
            document.body.appendChild(indicator);
            
            setTimeout(() => indicator.remove(), 3000);
        }

        function toggleAudio() {
            audioEnabled = !audioEnabled;
            showInAppNotification(`Audio ${audioEnabled ? 'enabled' : 'disabled'} 🔊`);
            if (!audioEnabled && currentAudio) {
                speechSynthesis.cancel();
            }
        }

        // App Functions
        window.startApp = function() {
            showScreen('main');
            enableLocation();
            initializeSpeech();
        };

        // Location Services with real geocoding
        window.enableLocation = function() {
            if (!navigator.geolocation) {
                alert('Geolocation not supported');
                return;
            }

            const options = {
                enableHighAccuracy: true,
                timeout: 10000,
                maximumAge: 60000
            };

            navigator.geolocation.watchPosition(
                function(position) {
                    currentLocation = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude,
                        accuracy: position.coords.accuracy
                    };
                    
                    isLocationEnabled = true;
                    updateLocationUI();
                    reverseGeocode(currentLocation.lat, currentLocation.lng);
                    showInAppNotification("Location enabled! Getting real place data...");
                },
                function(error) {
                    console.log('Location error:', error);
                    showInAppNotification("Please enable location access to discover real places");
                },
                options
            );
        };

        // Reverse geocoding using OpenStreetMap Nominatim (free API)
        async function reverseGeocode(lat, lng) {
            try {
                showInAppNotification("Getting location details...");
                
                const response = await fetch(
                    `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}&zoom=18&addressdetails=1`
                );
                
                if (!response.ok) throw new Error('Geocoding failed');
                
                const data = await response.json();
                console.log('Geocoding data:', data);
                
                currentAddress = data;
                displayLocationInfo(data);
                findNearbyPlaces(lat, lng);
                
            } catch (error) {
                console.error('Geocoding error:', error);
                showInAppNotification("Couldn't get location details - trying alternative...");
                // Fallback to basic coordinate display
                displayBasicLocation();
            }
        }

        function displayLocationInfo(addressData) {
            const address = addressData.address || {};
            const displayName = addressData.display_name || 'Unknown location';
            
            // Update current location display
            document.getElementById('current-location-info').style.display = 'block';
            
            // Extract address components
            const streetName = address.road || address.pedestrian || address.footway || 'Unknown street';
            const area = address.suburb || address.neighbourhood || address.village || address.town || address.city || 'Unknown area';
            const postcode = address.postcode || 'No postcode';
            
            document.getElementById('street-name').textContent = streetName;
            document.getElementById('area-name').textContent = area;
            document.getElementById('postal-code').textContent = postcode;
            
            // Create location details
            const locationDetails = document.getElementById('location-details');
            let detailsHTML = '';
            
            // Street information
            if (streetName !== 'Unknown street') {
                detailsHTML += `
                    <div class="location-card street">
                        <div class="location-header">
                            <div class="location-title">🛣️ ${streetName}</div>
                            <div class="location-tag">street</div>
                        </div>
                        <div class="location-content">You're currently on ${streetName} in ${area}.</div>
                        <div class="location-meta">Road type: ${address.highway || 'residential'}</div>
                    </div>
                `;
            }
            
            // Area information
            if (area !== 'Unknown area') {
                detailsHTML += `
                    <div class="location-card area">
                        <div class="location-header">
                            <div class="location-title">🏘️ ${area}</div>
                            <div class="location-tag">area</div>
                        </div>
                        <div class="location-content">This is the ${area} area of ${address.city || address.town || 'the city'}.</div>
                        <div class="location-meta">${address.country || 'Unknown country'}</div>
                    </div>
                `;
            }
            
            // Postal code information
            if (postcode !== 'No postcode') {
                detailsHTML += `
                    <div class="location-card postal">
                        <div class="location-header">
                            <div class="location-title">📮 ${postcode}</div>
                            <div class="location-tag">postal</div>
                        </div>
                        <div class="location-content">Postal code ${postcode} serves this local area.</div>
                        <div class="location-meta">UK postal district</div>
                    </div>
                `;
            }
            
            locationDetails.innerHTML = detailsHTML;
            
            // Play audio announcement
            const audioText = `You are on ${streetName} in ${area}, postcode ${postcode}`;
            playAudioDescription(audioText);
            
            updateStats();
        }

        function displayBasicLocation() {
            if (!currentLocation) return;
            
            document.getElementById('current-location-info').style.display = 'block';
            document.getElementById('street-name').textContent = `Lat: ${currentLocation.lat.toFixed(6)}`;
            document.getElementById('area-name').textContent = `Lng: ${currentLocation.lng.toFixed(6)}`;
            document.getElementById('postal-code').textContent = `Accuracy: ${currentLocation.accuracy}m`;
            
            const locationDetails = document.getElementById('location-details');
            locationDetails.innerHTML = `
                <div class="location-card">
                    <div class="location-header">
                        <div class="location-title">📍 Coordinates</div>
                        <div class="location-tag">basic</div>
                    </div>
                    <div class="location-content">Location: ${currentLocation.lat.toFixed(6)}, ${currentLocation.lng.toFixed(6)}</div>
                    <div class="location-meta">GPS accuracy: ${currentLocation.accuracy} meters</div>
                </div>
            `;
        }

        // Find nearby places using Overpass API (OpenStreetMap data)
        async function findNearbyPlaces(lat, lng) {
            try {
                showInAppNotification("Searching for nearby places...");
                
                // Overpass API query for nearby amenities
                const overpassQuery = `
                    [out:json][timeout:25];
                    (
                        node["amenity"](around:200,${lat},${lng});
                        node["shop"](around:200,${lat},${lng});
                        node["leisure"](around:200,${lat},${lng});
                    );
                    out body;
                `;
                
                const response = await fetch('https://overpass-api.de/api/interpreter', {
                    method: 'POST',
                    body: overpassQuery
                });
                
                if (!response.ok) throw new Error('Overpass API failed');
                
                const data = await response.json();
                console.log('Nearby places:', data);
                
                displayNearbyPlaces(data.elements);
                
            } catch (error) {
                console.error('Nearby places error:', error);
                document.getElementById('nearby-places').innerHTML = `
                    <div class="empty-state">
                        <div style="font-size: 32px; margin-bottom: 15px;">❌</div>
                        <div>Couldn't load nearby places</div>
                        <div style="font-size: 12px; margin-top: 5px;">Check internet connection</div>
                    </div>
                `;
            }
        }

        function displayNearbyPlaces(places) {
            const container = document.getElementById('nearby-places');
            
            if (places.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div style="font-size: 32px; margin-bottom: 15px;">🏜️</div>
                        <div>No businesses found nearby</div>
                        <div style="font-size: 12px; margin-top: 5px;">This might be a residential area</div>
                    </div>
                `;
                return;
            }
            
            let placesHTML = '';
            const uniquePlaces = new Set();
            
            places.slice(0, 10).forEach(place => {
                const tags = place.tags || {};
                const name = tags.name || tags.brand || 'Unnamed place';
                const type = tags.amenity || tags.shop || tags.leisure || 'unknown';
                
                // Avoid duplicates
                const placeKey = `${name}-${type}`;
                if (uniquePlaces.has(placeKey)) return;
                uniquePlaces.add(placeKey);
                
                const distance = calculateDistance(
                    currentLocation.lat, currentLocation.lng,
                    place.lat, place.lon
                );
                
                const icon = getPlaceIcon(type);
                const category = getPlaceCategory(type);
                
                placesHTML += `
                    <div class="location-card business">
                        <div class="location-header">
                            <div class="location-title">${icon} ${name}</div>
                            <div class="location-tag">${category}</div>
                        </div>
                        <div class="location-content">${getPlaceDescription(type, name)}</div>
                        <div class="location-meta">${Math.round(distance)}m away • ${type}</div>
                    </div>
                `;
            });
            
            container.innerHTML = placesHTML || `
                <div class="empty-state">
                    <div style="font-size: 32px; margin-bottom: 15px;">🏪</div>
                    <div>Processing nearby places...</div>
                </div>
            `;
        }

        function getPlaceIcon(type) {
            const icons = {
                restaurant: '🍽️', cafe: '☕', pub: '🍺', bank: '🏦', 
                pharmacy: '💊', shop: '🏪', supermarket: '🛒',
                hospital: '🏥', school: '🏫', library: '📚',
                park: '🌳', gym: '💪', hotel: '🏨', 
                post_office: '📮', police: '👮', fire_station: '🚒'
            };
            return icons[type] || '📍';
        }

        function getPlaceCategory(type) {
            const categories = {
                restaurant: 'food', cafe: 'food', pub: 'food',
                bank: 'finance', pharmacy: 'health', 
                shop: 'retail', supermarket: 'retail',
                hospital: 'health', school: 'education',
                library: 'education', park: 'recreation',
                gym: 'fitness', hotel: 'accommodation'
            };
            return categories[type] || 'place';
        }

        function getPlaceDescription(type, name) {
            const descriptions = {
                restaurant: `${name} serves food and drinks to local customers.`,
                cafe: `${name} is a local cafe serving coffee and light meals.`,
                pub: `${name} is a traditional British pub in your area.`,
                bank: `${name} provides banking services to the local community.`,
                pharmacy: `${name} offers prescription medicines and health products.`,
                shop: `${name} is a local shop serving the neighborhood.`,
                supermarket: `${name} is a supermarket with groceries and household items.`,
                hospital: `${name} provides medical care and emergency services.`,
                school: `${name} is an educational institution in your area.`,
                library: `${name} offers books and community services.`,
                park: `${name} is a green space for recreation and relaxation.`
            };
            return descriptions[type] || `${name} is a local ${type} in your area.`;
        }

        function updateLocationUI() {
            const statusIndicator = document.getElementById('location-status');
            const locationText = document.getElementById('location-text');
            const locationDisplay = document.getElementById('location-display');
            const locationCoords = document.getElementById('location-coords');
            const locationBtn = document.getElementById('location-btn');

            if (isLocationEnabled && currentLocation) {
                statusIndicator.className = 'status-indicator active';
                locationText.textContent = 'Active';
                locationDisplay.textContent = 'Getting real location data...';
                locationCoords.textContent = `${currentLocation.lat.toFixed(6)}, ${currentLocation.lng.toFixed(6)}`;
                locationBtn.style.display = 'none';
            } else {
                statusIndicator.className = 'status-indicator inactive';
                locationText.textContent = 'Inactive';
                locationDisplay.textContent = 'Enable location to discover real places';
                locationCoords.textContent = '';
                locationBtn.style.display = 'block';
            }
        }

        function updateStats() {
            document.getElementById('discoveries-count').textContent = discoveries.length;
            document.getElementById('locations-scanned').textContent = scanCount;
            
            if (discoveries.length > 0) {
                const lastTime = discoveries[0].timestamp.toLocaleTimeString('en-GB', { 
                    hour: '2-digit', 
                    minute: '2-digit',
                    hour12: false 
                });
                document.getElementById('last-discovery').textContent = lastTime;
            }
        }

        // Manual scan function
        window.scanCurrentArea = function() {
            if (!currentLocation) {
                showInAppNotification('Enable location first!');
                return;
            }

            const scanBtn = document.getElementById('scan-btn');
            scanBtn.classList.add('scanning');
            
            scanCount++;
            
            setTimeout(() => {
                scanBtn.classList.remove('scanning');
                reverseGeocode(currentLocation.lat, currentLocation.lng);
                showInAppNotification('Area scanned! Updated location data.');
            }, 2000);
        };

        // Utility Functions
        function calculateDistance(lat1, lng1, lat2, lng2) {
            const R = 6371e3; // Earth's radius in meters
            const φ1 = lat1 * Math.PI/180;
            const φ2 = lat2 * Math.PI/180;
            const Δφ = (lat2-lat1) * Math.PI/180;
            const Δλ = (lng2-lng1) * Math.PI/180;

            const a = Math.sin(Δφ/2) * Math.sin(Δφ/2) +
                      Math.cos(φ1) * Math.cos(φ2) *
                      Math.sin(Δλ/2) * Math.sin(Δλ/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));

            return R * c;
        }

        function showInAppNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'notification-banner';
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 4000);
        }

        // Modal Functions
        function showDiscoveryModal(discovery) {
            document.getElementById('modal-icon').textContent = discovery.icon;
            document.getElementById('modal-title').textContent = discovery.title;
            document.getElementById('modal-tag').textContent = discovery.type;
            document.getElementById('modal-content').textContent = discovery.content;
            document.getElementById('modal-meta').textContent = discovery.meta;
            document.getElementById('discovery-modal').style.display = 'block';
        }

        window.closeModal = function() {
            document.getElementById('discovery-modal').style.display = 'none';
        };

        // Navigation
        function showScreen(screenName) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            
            const screenMap = {
                'login': 'login-screen',
                'main': 'main-screen'
            };
            
            document.getElementById(screenMap[screenName]).classList.add('active');
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('discovery-modal');
            if (event.target === modal) {
                closeModal();
            }
        };

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            initializeSpeech();
        });
    </script>
</body>
</html>
